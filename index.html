<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="theme-color" content="#f7f3ee">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="å¤§äº”äººæ ¼é¤Šè€">
<meta name="description" content="å¤§äº”äººæ ¼é¤Šè€éœ€æ±‚è©•ä¼°å•å· - é«˜ç«¯é¤Šè€æœå‹™åŒ¹é…ç³»çµ±">
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icon-192.png">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@300;400;600;700&family=Ma+Shan+Zheng&family=ZCOOL+QingKe+HuangYou&display=swap" rel="stylesheet">
<title>å¤§äº”äººæ ¼ Â· é«˜ç«¯é¤Šè€è©•ä¼°</title>
<style>
  :root {
    --bg: #ffffff;
    --bg2: #f7f3ee;
    --bg3: #ede8e0;
    --ink: #1c1510;
    --ink2: #3a2e24;
    --ink3: #6b5c4e;
    --gold: #b8860b;
    --gold2: #d4a017;
    --gold3: #f0c040;
    --jade: #2e7d5e;
    --jade2: #3a9972;
    --crimson: #8b2635;
    --blue: #2e6da4;
    --blue2: #4a8ec2;
    --orange: #c07020;
    --orange2: #e09040;
    --pink: #b05878;
    --pink2: #d07898;
    --purple: #7050a0;
    --purple2: #9070c0;
    --shadow: 0 2px 16px rgba(28,21,16,0.10);
    --shadow2: 0 4px 24px rgba(28,21,16,0.14);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

  body {
    font-family: 'Noto Serif SC', serif;
    background: var(--bg);
    color: var(--ink);
    min-height: 100vh;
    min-height: -webkit-fill-available;
    overflow-x: hidden;
  }

  /* Subtle warm background pattern */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background: 
      radial-gradient(ellipse at 10% 0%, rgba(184,134,11,0.06) 0%, transparent 45%),
      radial-gradient(ellipse at 90% 100%, rgba(46,125,94,0.05) 0%, transparent 45%),
      linear-gradient(180deg, #f7f3ee 0%, #ffffff 30%, #f7f3ee 100%);
    pointer-events: none;
    z-index: 0;
  }

  .app {
    position: relative;
    z-index: 1;
    max-width: 480px;
    margin: 0 auto;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }

  /* â”€â”€â”€ SCREENS â”€â”€â”€ */
  .screen { display: none; padding: 24px 20px; flex: 1; animation: fadeIn 0.4s ease; }
  .screen.active { display: flex; flex-direction: column; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }

  /* â”€â”€â”€ HEADER â”€â”€â”€ */
  .header {
    text-align: center;
    padding: 48px 20px 32px;
    position: relative;
  }
  .header::after {
    content: '';
    display: block;
    width: 60px;
    height: 2px;
    background: linear-gradient(90deg, transparent, var(--gold2), transparent);
    margin: 20px auto 0;
  }
  .logo-text {
    font-family: 'Ma Shan Zheng', serif;
    font-size: 2.8rem;
    color: var(--gold);
    text-shadow: 0 2px 8px rgba(184,134,11,0.2);
    letter-spacing: 0.1em;
    line-height: 1.2;
  }
  .logo-sub {
    font-size: 0.85rem;
    color: var(--ink3);
    margin-top: 8px;
    letter-spacing: 0.25em;
  }

  /* â”€â”€â”€ WELCOME â”€â”€â”€ */
  .welcome-card {
    background: #ffffff;
    border: 1px solid rgba(184,134,11,0.25);
    border-radius: 16px;
    padding: 28px 24px;
    margin: 16px 0 24px;
    box-shadow: var(--shadow);
  }
  .welcome-card h2 {
    font-size: 1.15rem;
    color: var(--ink2);
    margin-bottom: 12px;
    font-weight: 600;
  }
  .welcome-card p {
    font-size: 0.88rem;
    line-height: 1.8;
    color: var(--ink3);
  }
  .trait-pills {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 16px;
  }
  .trait-pill {
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.78rem;
    border: 1px solid;
    letter-spacing: 0.05em;
    font-weight: 500;
  }
  .pill-o { border-color: var(--blue); color: var(--blue); background: rgba(46,109,164,0.08); }
  .pill-c { border-color: var(--jade); color: var(--jade); background: rgba(46,125,94,0.08); }
  .pill-e { border-color: var(--orange); color: var(--orange); background: rgba(192,112,32,0.08); }
  .pill-a { border-color: var(--pink); color: var(--pink); background: rgba(176,88,120,0.08); }
  .pill-n { border-color: var(--purple); color: var(--purple); background: rgba(112,80,160,0.08); }

  /* â”€â”€â”€ BUTTON â”€â”€â”€ */
  .btn-primary {
    width: 100%;
    padding: 16px;
    background: linear-gradient(135deg, var(--gold2) 0%, var(--gold) 100%);
    border: none;
    border-radius: 12px;
    color: #ffffff;
    font-family: 'Noto Serif SC', serif;
    font-size: 1rem;
    font-weight: 700;
    letter-spacing: 0.15em;
    cursor: pointer;
    transition: all 0.2s;
    box-shadow: 0 4px 16px rgba(184,134,11,0.35);
    -webkit-appearance: none;
  }
  .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 6px 24px rgba(184,134,11,0.45); }
  .btn-primary:active { transform: translateY(1px); }
  .btn-secondary {
    background: #ffffff;
    border: 1.5px solid rgba(184,134,11,0.5);
    color: var(--gold);
    font-family: 'Noto Serif SC', serif;
    font-size: 0.9rem;
    padding: 12px 24px;
    border-radius: 10px;
    cursor: pointer;
    letter-spacing: 0.1em;
    transition: all 0.2s;
    -webkit-appearance: none;
    box-shadow: 0 1px 4px rgba(28,21,16,0.08);
  }
  .btn-secondary:hover { background: var(--bg2); border-color: var(--gold); }

  /* â”€â”€â”€ FORM â”€â”€â”€ */
  .section-title {
    font-family: 'ZCOOL QingKe HuangYou', serif;
    font-size: 1.3rem;
    color: var(--ink2);
    margin-bottom: 20px;
    text-align: center;
    letter-spacing: 0.1em;
  }
  .form-group { margin-bottom: 20px; }
  .form-label {
    display: block;
    font-size: 0.82rem;
    color: var(--ink3);
    margin-bottom: 8px;
    letter-spacing: 0.12em;
    font-weight: 500;
  }
  .form-input {
    width: 100%;
    padding: 13px 16px;
    background: #ffffff;
    border: 1.5px solid #ddd5c8;
    border-radius: 10px;
    color: var(--ink);
    font-family: 'Noto Serif SC', serif;
    font-size: 0.95rem;
    transition: border-color 0.2s, box-shadow 0.2s;
    -webkit-appearance: none;
    appearance: none;
    box-shadow: 0 1px 3px rgba(28,21,16,0.05);
  }
  .form-input:focus {
    outline: none;
    border-color: var(--gold2);
    box-shadow: 0 0 0 3px rgba(212,160,23,0.15);
  }
  .form-input option { background: #ffffff; color: var(--ink); }
  .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
  .radio-group { display: flex; gap: 12px; }
  .radio-label {
    flex: 1;
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 12px 14px;
    background: #ffffff;
    border: 1.5px solid #ddd5c8;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.2s;
    font-size: 0.9rem;
    color: var(--ink2);
    box-shadow: 0 1px 3px rgba(28,21,16,0.05);
  }
  .radio-label input { accent-color: var(--gold); width: 16px; height: 16px; }
  .radio-label.selected { background: rgba(212,160,23,0.08); border-color: var(--gold2); color: var(--gold); }

  /* â”€â”€â”€ PROGRESS â”€â”€â”€ */
  .progress-bar-wrap {
    background: #e8e0d5;
    border-radius: 4px;
    height: 5px;
    margin-bottom: 8px;
    overflow: hidden;
  }
  .progress-bar {
    height: 100%;
    background: linear-gradient(90deg, var(--jade2), var(--gold2));
    border-radius: 4px;
    transition: width 0.4s ease;
  }
  .progress-text {
    font-size: 0.75rem;
    color: var(--ink3);
    text-align: right;
    margin-bottom: 20px;
    letter-spacing: 0.05em;
  }

  /* â”€â”€â”€ QUESTIONS â”€â”€â”€ */
  .q-header {
    margin-bottom: 24px;
  }
  .q-dimension {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.75rem;
    margin-bottom: 12px;
    letter-spacing: 0.08em;
    font-weight: 500;
  }
  .q-text {
    font-size: 1.08rem;
    line-height: 1.8;
    color: var(--ink);
    font-weight: 400;
  }

  .scale-container { margin: 28px 0; }
  .scale-labels {
    display: flex;
    justify-content: space-between;
    font-size: 0.72rem;
    color: var(--ink3);
    margin-bottom: 16px;
    letter-spacing: 0.05em;
  }
  .scale-options {
    display: flex;
    justify-content: space-between;
    gap: 6px;
  }
  .scale-btn {
    flex: 1;
    aspect-ratio: 1;
    border-radius: 50%;
    border: 2px solid #ccc3b8;
    background: #ffffff;
    color: var(--ink3);
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    -webkit-appearance: none;
    min-width: 44px;
    min-height: 44px;
    box-shadow: 0 1px 4px rgba(28,21,16,0.08);
  }
  .scale-btn:hover { border-color: var(--gold2); color: var(--gold); background: rgba(212,160,23,0.05); }
  .scale-btn.selected {
    background: var(--gold2);
    border-color: var(--gold2);
    color: #ffffff;
    font-weight: 700;
    transform: scale(1.12);
    box-shadow: 0 4px 16px rgba(212,160,23,0.45);
  }

  .q-nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 24px;
    gap: 12px;
  }
  .q-nav .btn-secondary { flex: 1; }
  .q-nav .btn-primary { flex: 2; padding: 14px; }

  /* â”€â”€â”€ RESULTS â”€â”€â”€ */
  .result-header {
    text-align: center;
    margin-bottom: 28px;
  }
  .result-name {
    font-family: 'ZCOOL QingKe HuangYou', serif;
    font-size: 1.8rem;
    color: var(--ink2);
    letter-spacing: 0.1em;
  }
  .result-meta {
    font-size: 0.8rem;
    color: var(--ink3);
    margin-top: 6px;
    letter-spacing: 0.08em;
  }
  .result-type-badge {
    display: inline-block;
    margin: 16px auto;
    padding: 10px 28px;
    background: linear-gradient(135deg, rgba(212,160,23,0.15), rgba(184,134,11,0.08));
    border: 1.5px solid var(--gold2);
    border-radius: 30px;
    font-size: 0.95rem;
    color: var(--gold);
    letter-spacing: 0.12em;
    font-weight: 600;
    box-shadow: 0 2px 10px rgba(184,134,11,0.15);
  }

  .dimension-card {
    background: #ffffff;
    border-radius: 14px;
    padding: 20px;
    margin-bottom: 14px;
    border: 1px solid #e8e0d5;
    position: relative;
    overflow: hidden;
    box-shadow: var(--shadow);
  }
  .dimension-card::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 4px;
    border-radius: 4px 0 0 4px;
  }
  .d-o::before { background: var(--blue2); }
  .d-c::before { background: var(--jade2); }
  .d-e::before { background: var(--orange2); }
  .d-a::before { background: var(--pink2); }
  .d-n::before { background: var(--purple2); }

  .dim-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
  .dim-name { font-size: 0.95rem; font-weight: 600; letter-spacing: 0.08em; color: var(--ink2); }
  .dim-score {
    font-family: 'Ma Shan Zheng', serif;
    font-size: 1.6rem;
    font-weight: 700;
  }
  .d-o .dim-score { color: var(--blue); }
  .d-c .dim-score { color: var(--jade); }
  .d-e .dim-score { color: var(--orange); }
  .d-a .dim-score { color: var(--pink); }
  .d-n .dim-score { color: var(--purple); }

  .bar-track {
    background: #e8e0d5;
    border-radius: 4px;
    height: 7px;
    margin-bottom: 10px;
    overflow: hidden;
  }
  .bar-fill {
    height: 100%;
    border-radius: 4px;
    transition: width 1s cubic-bezier(.4,0,.2,1);
  }
  .d-o .bar-fill { background: linear-gradient(90deg, var(--blue), var(--blue2)); }
  .d-c .bar-fill { background: linear-gradient(90deg, var(--jade), var(--jade2)); }
  .d-e .bar-fill { background: linear-gradient(90deg, var(--orange), var(--orange2)); }
  .d-a .bar-fill { background: linear-gradient(90deg, var(--pink), var(--pink2)); }
  .d-n .bar-fill { background: linear-gradient(90deg, var(--purple), var(--purple2)); }

  .dim-label {
    font-size: 0.78rem;
    color: var(--ink3);
    letter-spacing: 0.05em;
    display: flex;
    justify-content: space-between;
  }

  .insight-card {
    background: #ffffff;
    border: 1px solid #e8e0d5;
    border-radius: 14px;
    padding: 20px;
    margin-bottom: 14px;
    box-shadow: var(--shadow);
  }
  .insight-title {
    font-size: 0.82rem;
    color: var(--gold);
    letter-spacing: 0.18em;
    margin-bottom: 14px;
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 700;
    text-transform: uppercase;
  }
  .insight-title::before {
    content: '';
    display: inline-block;
    width: 20px;
    height: 2px;
    background: var(--gold2);
    border-radius: 2px;
  }
  .insight-item {
    font-size: 0.87rem;
    line-height: 1.75;
    color: var(--ink2);
    padding: 9px 0;
    border-bottom: 1px solid #f0e8e0;
    display: flex;
    align-items: flex-start;
    gap: 10px;
  }
  .insight-item:last-child { border-bottom: none; }
  .insight-dot {
    width: 7px;
    height: 7px;
    border-radius: 50%;
    background: var(--gold2);
    margin-top: 7px;
    flex-shrink: 0;
  }

  .priority-badge {
    display: inline-block;
    padding: 6px 18px;
    border-radius: 6px;
    font-size: 0.85rem;
    font-weight: 700;
    letter-spacing: 0.1em;
    margin-top: 14px;
  }
  .priority-A { background: rgba(184,134,11,0.12); color: var(--gold); border: 1.5px solid var(--gold2); }
  .priority-B { background: rgba(46,125,94,0.10); color: var(--jade); border: 1.5px solid var(--jade2); }
  .priority-C { background: rgba(46,109,164,0.10); color: var(--blue); border: 1.5px solid var(--blue2); }
  .priority-D { background: rgba(112,80,160,0.10); color: var(--purple); border: 1.5px solid var(--purple2); }

  .btn-group {
    display: flex;
    gap: 10px;
    margin-top: 24px;
    margin-bottom: 32px;
    flex-wrap: wrap;
  }
  .btn-group .btn-primary { flex: 2; }
  .btn-group .btn-secondary { flex: 1; }

  /* â”€â”€â”€ DIVIDER â”€â”€â”€ */
  .ornamental-divider {
    text-align: center;
    margin: 22px 0;
    color: var(--gold2);
    font-size: 1rem;
    letter-spacing: 0.5em;
    opacity: 0.7;
  }

  /* â”€â”€â”€ LOADING â”€â”€â”€ */
  .loading-screen {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 20px;
  }
  .spinner {
    width: 50px;
    height: 50px;
    border: 3px solid #e8e0d5;
    border-top-color: var(--gold2);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
  .loading-text { font-size: 0.9rem; color: var(--ink3); letter-spacing: 0.2em; }

  /* â”€â”€â”€ SAFE AREA â”€â”€â”€ */
  .safe-bottom { padding-bottom: max(16px, env(safe-area-inset-bottom)); }
  .safe-top { padding-top: max(0px, env(safe-area-inset-top)); }

  /* â”€â”€â”€ SCROLLABLE â”€â”€â”€ */
  .scrollable { overflow-y: auto; -webkit-overflow-scrolling: touch; }

  /* Install prompt */
  .install-banner {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: #ffffff;
    border-top: 1px solid #e0d8cc;
    padding: 16px 20px;
    padding-bottom: max(16px, env(safe-area-inset-bottom));
    display: none;
    align-items: center;
    gap: 12px;
    z-index: 100;
    animation: slideUp 0.3s ease;
    box-shadow: 0 -4px 20px rgba(28,21,16,0.10);
  }
  @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
  .install-banner.visible { display: flex; }
  .install-banner p { flex: 1; font-size: 0.82rem; color: var(--ink3); line-height: 1.4; }
  .install-btn { padding: 8px 16px; background: var(--gold2); color: #ffffff; border: none; border-radius: 8px; font-size: 0.82rem; font-weight: 700; cursor: pointer; white-space: nowrap; }
  .install-close { background: none; border: none; color: #aaa; font-size: 1.2rem; cursor: pointer; padding: 4px; }
</style>
</head>
<body>

<div class="app">

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• WELCOME SCREEN â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="screen active" id="screen-welcome">
    <div class="header safe-top">
      <div class="logo-text">å¤§äº”äººæ ¼</div>
      <div class="logo-text" style="font-size:1.6rem; color: var(--gold);">é«˜ç«¯é¤Šè€è©•ä¼°</div>
      <div class="logo-sub">Big Five Personality Â· Senior Living Assessment</div>
    </div>

    <div class="welcome-card">
      <h2>ğŸ® è©•ä¼°èªªæ˜</h2>
      <p>æœ¬å•å·åŸºæ–¼åœ‹éš›æ¬Šå¨å¤§äº”äººæ ¼ï¼ˆBFI-10ï¼‰æ¨¡å‹ï¼Œçµåˆé«˜ç«¯é¤Šè€æœå‹™å ´æ™¯ï¼Œç‚ºæ‚¨é‡èº«åˆ†æé¤Šè€éœ€æ±‚åå¥½èˆ‡æ¶ˆè²»è¡Œç‚ºç‰¹å¾ï¼Œç²¾æº–åŒ¹é…é«˜ç«¯é¤Šè€æœƒå“¡æœå‹™ã€‚</p>
      <div class="trait-pills">
        <span class="trait-pill pill-o">é–‹æ”¾æ€§ Openness</span>
        <span class="trait-pill pill-c">ç›¡è²¬æ€§ Conscientiousness</span>
        <span class="trait-pill pill-e">å¤–å‘æ€§ Extraversion</span>
        <span class="trait-pill pill-a">å®œäººæ€§ Agreeableness</span>
        <span class="trait-pill pill-n">æƒ…ç·’ç©©å®šæ€§ Neuroticism</span>
      </div>
    </div>

    <div class="welcome-card" style="margin-bottom: 28px;">
      <h2>ğŸ“‹ å•å·è³‡è¨Š</h2>
      <p>å…± <strong style="color:var(--gold)">10</strong> é“é¡Œï¼Œç´„ <strong style="color:var(--gold)">3-5</strong> åˆ†é˜å®Œæˆã€‚æ¯é¡Œè«‹åœ¨ 1-5 åˆ†é‡è¡¨ä¸Šè©•åˆ†ï¼š<br><br>
      <strong style="color:var(--gold)">1</strong> = éå¸¸ä¸ç¬¦åˆ &nbsp;â”‚&nbsp; <strong style="color:var(--gold)">5</strong> = éå¸¸ç¬¦åˆ</p>
    </div>

    <div style="margin-top: auto;">
      <button class="btn-primary" onclick="showScreen('screen-info')">é–‹å§‹å¡«å¯«å•å· â†’</button>
    </div>

    <div class="safe-bottom"></div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• INFO SCREEN â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="screen" id="screen-info">
    <div style="margin-bottom: 8px; padding-top: max(0px, env(safe-area-inset-top));">
      <div class="section-title">åŸºæœ¬è³‡æ–™</div>
    </div>

    <div style="flex: 1; overflow-y: auto; -webkit-overflow-scrolling: touch;">
      <div class="form-group">
        <label class="form-label">å§“å</label>
        <input type="text" class="form-input" id="f-name" placeholder="è«‹è¼¸å…¥æ‚¨çš„å§“å">
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label">æ€§åˆ¥</label>
          <select class="form-input" id="f-gender">
            <option value="">è«‹é¸æ“‡</option>
            <option value="male">ç”·æ€§</option>
            <option value="female">å¥³æ€§</option>
            <option value="other">å…¶ä»–</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">ç”Ÿæ—¥ï¼ˆyyyy-mm-ddï¼‰</label>
          <input type="date" class="form-input" id="f-birthday" placeholder="yyyy-mm-dd">
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">å©šå§»ç‹€æ³</label>
        <div class="radio-group">
          <label class="radio-label" id="marital-1" onclick="selectMarital('married')">
            <input type="radio" name="marital" value="married"> 1. å·²å©š
          </label>
          <label class="radio-label" id="marital-2" onclick="selectMarital('single')">
            <input type="radio" name="marital" value="single"> 2. æœªå©š
          </label>
        </div>
      </div>
    </div>

    <div class="ornamental-divider">âœ¦ âœ¦ âœ¦</div>

    <div style="display: flex; gap: 12px; padding-bottom: max(16px, env(safe-area-inset-bottom));">
      <button class="btn-secondary" onclick="showScreen('screen-welcome')">â† è¿”å›</button>
      <button class="btn-primary" onclick="validateInfo()">ä¸‹ä¸€æ­¥ â†’</button>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• QUESTION SCREEN â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="screen" id="screen-questions">
    <div style="padding-top: max(8px, env(safe-area-inset-top));">
      <div class="progress-bar-wrap">
        <div class="progress-bar" id="progress-bar" style="width: 10%"></div>
      </div>
      <div class="progress-text" id="progress-text">ç¬¬ 1 é¡Œ / å…± 10 é¡Œ</div>
    </div>

    <div class="q-header">
      <div class="q-dimension" id="q-dimension"></div>
      <div class="q-text" id="q-text"></div>
    </div>

    <div class="scale-container">
      <div class="scale-labels">
        <span>éå¸¸ä¸ç¬¦åˆ</span>
        <span>éå¸¸ç¬¦åˆ</span>
      </div>
      <div class="scale-options" id="scale-options">
        <button class="scale-btn" onclick="selectScale(1)">1</button>
        <button class="scale-btn" onclick="selectScale(2)">2</button>
        <button class="scale-btn" onclick="selectScale(3)">3</button>
        <button class="scale-btn" onclick="selectScale(4)">4</button>
        <button class="scale-btn" onclick="selectScale(5)">5</button>
      </div>
    </div>

    <div style="flex: 1;"></div>

    <div class="q-nav safe-bottom">
      <button class="btn-secondary" onclick="prevQuestion()">â† ä¸Šé¡Œ</button>
      <button class="btn-primary" id="btn-next" onclick="nextQuestion()">ä¸‹ä¸€é¡Œ â†’</button>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• LOADING SCREEN â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="screen" id="screen-loading">
    <div class="loading-screen safe-top safe-bottom">
      <div style="font-family: 'Ma Shan Zheng'; font-size: 3rem; color: var(--gold); text-shadow: 0 2px 12px rgba(184,134,11,0.3);">æ˜“</div>
      <div class="spinner"></div>
      <div class="loading-text">æ­£åœ¨åˆ†ææ‚¨çš„äººæ ¼ç‰¹å¾â€¦â€¦</div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• RESULTS SCREEN â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="screen scrollable" id="screen-results" style="padding-top: max(20px, env(safe-area-inset-top));">
    <div class="result-header">
      <div class="result-name" id="res-name">â€”</div>
      <div class="result-meta" id="res-meta">â€”</div>
      <div class="result-type-badge" id="res-type">â€”</div>
    </div>

    <div class="ornamental-divider">âœ¦ äººæ ¼ç¶­åº¦åˆ†æ âœ¦</div>

    <div id="res-dimensions"></div>

    <div class="ornamental-divider">âœ¦ é¤Šè€éœ€æ±‚ç•«åƒ âœ¦</div>

    <div class="insight-card" id="res-needs"></div>
    <div class="insight-card" id="res-consumption"></div>
    <div class="insight-card" id="res-services"></div>

    <div class="ornamental-divider">âœ¦ æœƒå“¡é©é…è©•ç´š âœ¦</div>
    <div class="insight-card" id="res-membership"></div>

    <div class="btn-group safe-bottom">
      <button class="btn-primary" onclick="shareResult()">ğŸ“¤ åˆ†äº«çµæœ</button>
      <button class="btn-secondary" onclick="restartQuiz()">é‡æ–°å¡«å¯«</button>
    </div>
  </div>

</div>

<!-- Install Banner -->
<div class="install-banner" id="install-banner">
  <p>ğŸ“² å®‰è£åˆ°ä¸»è¢å¹•<br>æ–¹ä¾¿éš¨æ™‚æŸ¥çœ‹é¤Šè€è©•ä¼°</p>
  <button class="install-btn" id="install-btn" onclick="installPWA()">å®‰è£</button>
  <button class="install-close" onclick="closeInstallBanner()">âœ•</button>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATA: BFI-10 Questions (Rammstedt & John, 2007)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const QUESTIONS = [
  {
    id: 1, dimension: 'E', reversed: false,
    dimLabel: 'å¤–å‘æ€§ Extraversion',
    dimClass: 'pill-e',
    text: 'æˆ‘èªç‚ºè‡ªå·±æ˜¯ä¸€å€‹æ´»æ½‘ã€å¤–å‘çš„äººã€‚'
  },
  {
    id: 2, dimension: 'A', reversed: true,
    dimLabel: 'å®œäººæ€§ Agreeableness',
    dimClass: 'pill-a',
    text: 'æˆ‘èªç‚ºè‡ªå·±å‚¾å‘æ–¼æŒ‘å‰”åˆ¥äººçš„ç¼ºé»ã€‚ï¼ˆåå‘é¡Œï¼‰'
  },
  {
    id: 3, dimension: 'C', reversed: false,
    dimLabel: 'ç›¡è²¬æ€§ Conscientiousness',
    dimClass: 'pill-c',
    text: 'æˆ‘èªç‚ºè‡ªå·±æ˜¯ä¸€å€‹åšäº‹å¾¹åº•ã€å¯é çš„äººã€‚'
  },
  {
    id: 4, dimension: 'N', reversed: true,
    dimLabel: 'æƒ…ç·’ç©©å®šæ€§ Neuroticism',
    dimClass: 'pill-n',
    text: 'æˆ‘èªç‚ºè‡ªå·±æ˜¯ä¸€å€‹æ”¾é¬†ã€èƒ½æ‡‰å°å£“åŠ›çš„äººã€‚ï¼ˆåå‘é¡Œï¼‰'
  },
  {
    id: 5, dimension: 'O', reversed: false,
    dimLabel: 'é–‹æ”¾æ€§ Openness',
    dimClass: 'pill-o',
    text: 'æˆ‘èªç‚ºè‡ªå·±æœ‰è±å¯Œçš„æƒ³åƒåŠ›ï¼Œæ˜¯ä¸€å€‹æœ‰å‰µæ„çš„äººã€‚'
  },
  {
    id: 6, dimension: 'E', reversed: true,
    dimLabel: 'å¤–å‘æ€§ Extraversion',
    dimClass: 'pill-e',
    text: 'æˆ‘èªç‚ºè‡ªå·±æ¯”è¼ƒå…§æ–‚ã€å®‰éœã€‚ï¼ˆåå‘é¡Œï¼‰'
  },
  {
    id: 7, dimension: 'A', reversed: false,
    dimLabel: 'å®œäººæ€§ Agreeableness',
    dimClass: 'pill-a',
    text: 'æˆ‘èªç‚ºè‡ªå·±ç¸½é«”ä¸Šä¿¡ä»»ä»–äººï¼Œæ¨‚æ–¼åŠ©äººã€‚'
  },
  {
    id: 8, dimension: 'C', reversed: true,
    dimLabel: 'ç›¡è²¬æ€§ Conscientiousness',
    dimClass: 'pill-c',
    text: 'æˆ‘èªç‚ºè‡ªå·±æœ‰æ™‚æœƒç²—å¿ƒå¤§æ„ï¼Œç¼ºä¹æ¢ç†ã€‚ï¼ˆåå‘é¡Œï¼‰'
  },
  {
    id: 9, dimension: 'N', reversed: false,
    dimLabel: 'æƒ…ç·’ç©©å®šæ€§ Neuroticism',
    dimClass: 'pill-n',
    text: 'æˆ‘èªç‚ºè‡ªå·±å®¹æ˜“ç·Šå¼µã€ç„¦æ…®ï¼Œæƒ…ç·’èµ·ä¼è¼ƒå¤§ã€‚'
  },
  {
    id: 10, dimension: 'O', reversed: true,
    dimLabel: 'é–‹æ”¾æ€§ Openness',
    dimClass: 'pill-o',
    text: 'æˆ‘èªç‚ºè‡ªå·±å°è—è¡“ã€éŸ³æ¨‚å’Œæ–‡å­¸èˆˆè¶£ä¸€èˆ¬ï¼Œä¸å¤ªæœ‰æƒ³åƒåŠ›ã€‚ï¼ˆåå‘é¡Œï¼‰'
  }
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BIG FIVE â†’ ELDERLY CARE TRAITS DATABASE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DIMENSION_INFO = {
  O: {
    name: 'é–‹æ”¾æ€§',
    fullName: 'é–‹æ”¾æ€§ (Openness)',
    high: {
      label: 'é«˜é–‹æ”¾å‹',
      core: 'æ„›æ–°é®®ã€æ„›å­¸ç¿’ã€æ€æƒ³é–‹æ”¾ã€æƒ³è±¡åŠ›è±å¯Œ',
      need: 'ç²¾ç¥å……å¯¦ã€ç”Ÿæ´»å¤šæ¨£ã€æ‹’çµ•æ¯ç‡¥ã€é¡˜æ„å˜—è©¦æ–°äº‹ç‰©',
      consumption: 'æ–‡åŒ–æ—…éŠã€èˆˆè¶£èª²ç¨‹ã€æ™ºèƒ½ç”¢å“ã€æ–‡å‰µã€é«”é©—é¡æ¶ˆè²»',
      behavior: 'é¡˜ç‚ºé«”é©—ä»˜è²»ï¼Œæ¥å—æ–°äº‹ç‰©å¿«ï¼Œæ±ºç­–è¼ƒå¿«'
    },
    low: {
      label: 'ä½é–‹æ”¾å‹',
      core: 'å‚³çµ±ã€å‹™å¯¦ã€æ±‚å®‰ç©©ã€ä¸å–œè®ŠåŒ–ã€é‡è¦–ç¿’æ…£',
      need: 'ç©©å®šå®‰å…¨ã€ç†Ÿæ‚‰ç’°å¢ƒã€è¦å¾‹ç”Ÿæ´»ã€ç°¡å–®çœå¿ƒ',
      consumption: 'æ—¥ç”¨å“ã€è€å“ç‰Œã€å®¶å¸¸ä¼‘é–’ã€ç†Ÿäººæ¨è–¦',
      behavior: 'åªè²·ç†Ÿæ‚‰å¯é ç”¢å“ï¼ŒæŠ—æ‹’æ–°ç§‘æŠ€ï¼Œæ¶ˆè²»è¬¹æ…'
    }
  },
  C: {
    name: 'ç›¡è²¬æ€§',
    fullName: 'ç›¡è²¬æ€§ (Conscientiousness)',
    high: {
      label: 'é«˜ç›¡è²¬å‹',
      core: 'è‡ªå¾‹ã€æœ‰æ¢ç†ã€é‡å¥åº·ã€æ„›è¦åŠƒã€è²¬ä»»å¿ƒå¼·',
      need: 'å¥åº·ç®¡ç†ã€ç”Ÿæ´»ç§©åºã€è²¡å‹™å®‰å…¨ã€è¦ç¯„å¯é ',
      consumption: 'é«”æª¢é¤Šç”Ÿã€å¥åº·é£Ÿå“ã€æ”¶ç´å®¶å±…ã€æ­£è¦å°ˆæ¥­æœå‹™',
      behavior: 'ç†æ€§æ¶ˆè²»ï¼Œé‡è³‡è³ªå“è³ªï¼Œé¡˜ç‚ºå¥åº·èˆ‡å®‰å¿ƒä»˜è²»'
    },
    low: {
      label: 'ä½ç›¡è²¬å‹',
      core: 'éš¨æ€§ã€è‡ªç”±ã€ä¸æ„›ç´„æŸã€éš¨é‡è€Œå®‰ã€ä¸å–œç´°ç¯€',
      need: 'ç„¡å£“åŠ›ã€ç°¡å–®çœäº‹ã€å°‘éº»ç…©ã€ä¸æŠ˜é¨°',
      consumption: 'ä¾¿æ·ç”¨å“ã€ä¼‘é–’å¨›æ¨‚ã€æ‡¶äººå¥½ç‰©ã€è¼•é¬†æœå‹™',
      behavior: 'è¨å­è¤‡é›œæ“ä½œï¼Œè¿½æ±‚æ–¹ä¾¿èˆ’é©ï¼Œæ±ºç­–éš¨æ„'
    }
  },
  E: {
    name: 'å¤–å‘æ€§',
    fullName: 'å¤–å‘æ€§ (Extraversion)',
    high: {
      label: 'é«˜å¤–å‘å‹',
      core: 'æ„›ç¤¾äº¤ã€ç†±é¬§ã€æ´»èºã€ç†±æƒ…ã€å–œæ­¡é™ªä¼´',
      need: 'è±å¯Œç¤¾äº¤ã€é›†é«”æ´»å‹•ã€è¢«èªå¯ã€æœ‰äº‹å¯åš',
      consumption: 'ç¾¤é«”æ´»å‹•ã€åœ˜é«”æ—…éŠã€ç¤¾äº¤ç©¿æ­ã€èšé¤èšæœƒ',
      behavior: 'æ˜“å—åŒä¼´å½±éŸ¿ï¼Œå–œæ­¡è·Ÿé¢¨åœ˜è³¼ï¼Œæ„›ç†±é¬§æ¶ˆè²»'
    },
    low: {
      label: 'ä½å¤–å‘å‹ï¼ˆå…§å‘ï¼‰',
      core: 'å…§å‘ã€å–œç¨è™•ã€å…§æ–‚ã€æ€•åµé¬§',
      need: 'ç§å¯†å®‰éœã€ç¨è™•ç©ºé–“ã€æº«å’Œç°¡å–®äººéš›é—œä¿‚',
      consumption: 'é–±è®€ã€é¤ŠèŠ±ã€å±…å®¶ä¼‘é–’ã€å®‰éœç’°å¢ƒ',
      behavior: 'ä½èª¿ä¸å¼µæšï¼Œåæ„Ÿéåº¦æ¨éŠ·ï¼Œé‡è¦–èˆ’é©èˆ‡éš±ç§'
    }
  },
  A: {
    name: 'å®œäººæ€§',
    fullName: 'å®œäººæ€§ (Agreeableness)',
    high: {
      label: 'é«˜å®œäººå‹',
      core: 'å‹å–„ã€é«”è²¼ã€é‡å®¶åº­ã€æ¨‚æ–¼åŠ©äººã€ä¸æ„›è¡çª',
      need: 'è¦ªæƒ…é™ªä¼´ã€å‹å–„ç’°å¢ƒã€è¢«å°Šé‡ç…§é¡§ã€æ°›åœå’Œç¦',
      consumption: 'å®¶åº­ç”¨å“ã€å­«è¼©ç¦®ç‰©ã€è²¼å¿ƒæœå‹™ã€å¯¦æƒ å¥½ç‰©',
      behavior: 'ä¿¡ä»»å£ç¢‘èˆ‡ç†Ÿäººï¼Œåƒè»Ÿä¸åƒç¡¬ï¼Œé‡äººæƒ…å‘³'
    },
    low: {
      label: 'ä½å®œäººå‹ï¼ˆç¨ç«‹ï¼‰',
      core: 'ç¨ç«‹ã€ç†æ€§ã€æœ‰ä¸»è¦‹ã€è¬›äº‹å¯¦ã€ä¸å–œä¾è³´',
      need: 'è‡ªä¸»ç¨ç«‹ã€è¦å‰‡æ¸…æ™°ã€ä¸è¢«æ§åˆ¶ã€é«˜æ•ˆé€æ˜',
      consumption: 'é«˜æ€§åƒ¹æ¯”ã€å°ˆæ¥­æœå‹™ã€é€æ˜æ”¶è²»ã€å¯¦ç”¨ç”¢å“',
      behavior: 'é‡é‚è¼¯æ¢æ¬¾ï¼Œä¸åƒæƒ…æ„Ÿç‡ŸéŠ·ï¼Œæ±ºç­–å†·éœç¨ç«‹'
    }
  },
  N: {
    name: 'æƒ…ç·’ç©©å®šæ€§',
    fullName: 'æƒ…ç·’ç©©å®šæ€§ (Neuroticism)',
    high: {
      label: 'é«˜æƒ…ç·’æ•æ„Ÿå‹',
      core: 'æ˜“ç„¦æ…®ã€æ•æ„Ÿã€å¤šæ…®ã€åœ¨æ„å¥åº·èˆ‡å®‰å…¨',
      need: 'å¿ƒç†å®‰å…¨æ„Ÿã€é†«ç™‚å°±è¿‘ã€æ‡‰æ€¥ä¿éšœã€ç©©å®šå¯é æœŸ',
      consumption: 'ä¿éšªã€ç›£æ§è¨­å‚™ã€å¤§å“ç‰Œã€æœ‰ä¿éšœç”¢å“',
      behavior: 'å°å®‰å…¨é¢¨éšªæ•æ„Ÿï¼Œé¡˜æ„èŠ±éŒ¢è²·æ”¾å¿ƒã€æ±‚ç©©å¦¥'
    },
    low: {
      label: 'é«˜æƒ…ç·’ç©©å®šå‹',
      core: 'æ·¡å®šã€æ¨‚è§€ã€è±é”ã€å¿ƒæ…‹å¹³å’Œã€æŠ—å£“å¼·',
      need: 'è‡ªåœ¨ã€å¿ƒæ…‹èˆ’æš¢ã€ç°¡å–®å¿«æ¨‚ã€ç„¡å£“åŠ›',
      consumption: 'ä¼‘é–’æ”¾é¬†ã€è‡ªç„¶å¥åº·ã€ä½›ç³»ç”Ÿæ´»ã€ç°¡ç´„æ¶ˆè²»',
      behavior: 'ä¸ç„¦æ…®å›¤è²¨ï¼Œä¸éåº¦è¨ˆè¼ƒï¼Œå¿ƒæ…‹å¹³å’Œï¼Œç†æ€§ä½›ç³»'
    }
  }
};

const PERSONALITY_TYPES = [
  {
    id: 'achiever',
    name: 'å°Šå´‡è‡ªä¿¡æˆå°±å‹',
    priority: 'A',
    desc: 'å…·å‚™å¼·æ§åˆ¶åŠ›ã€é‡é«”é¢ã€ç›®æ¨™å°å‘ï¼Œæ˜¯é«˜ç«¯é¤Šè€æœƒå“¡åˆ¶çš„æ ¸å¿ƒå®¢ç¾¤',
    match: (s) => s.E >= 3.5 && s.C >= 3.5 && s.A <= 3.0
  },
  {
    id: 'conscientious-stable',
    name: 'å°½è²¬ç©©å¥å‹',
    priority: 'A',
    desc: 'è‡ªå¾‹è¦åŠƒã€é‡ç§©åºã€æ±‚å®‰ç©©ï¼Œå‚¾å‘é•·æœŸä¸»ç¾©ï¼Œç‚ºç¢ºå®šæ€§è²·å–®',
    match: (s) => s.C >= 3.5 && s.N <= 3.0
  },
  {
    id: 'social-vibrant',
    name: 'ç¤¾äº¤æ´»åŠ›å‹',
    priority: 'B',
    desc: 'ç†±æ„›ç¤¾äº¤ã€æ´»åŠ›å……æ²›ã€é‡äººè„ˆï¼Œæ˜¯ç¤¾ç¾¤æ´»å‹•çš„æ ¸å¿ƒç™¼èµ·è€…',
    match: (s) => s.E >= 3.5 && s.A >= 3.5
  },
  {
    id: 'rational-independent',
    name: 'ç†æ€§è‡ªä¸»å‹',
    priority: 'B',
    desc: 'ç¨ç«‹æ€è€ƒã€é‡éš±ç§ã€è¬›æ•ˆç‡ï¼Œç‚ºå°ˆæ¥­åº¦èˆ‡éš±ç§æ„Ÿä»˜è²»',
    match: (s) => s.A <= 2.8 && s.C >= 3.5
  },
  {
    id: 'open-explorer',
    name: 'é–‹æ”¾æ¢ç´¢å‹',
    priority: 'B',
    desc: 'æ¥å—æ–°äº‹ç‰©ã€æ„›å­¸ç¿’ã€æ±‚æ–°é®®ï¼Œé¡˜æ„ç‚ºé«”é©—èˆ‡èˆˆè¶£ä»˜è²»',
    match: (s) => s.O >= 3.5
  },
  {
    id: 'gentle-warmth',
    name: 'æº«å’Œå®œäººå‹',
    priority: 'C',
    desc: 'å‹å–„æº«å’Œã€é‡é™ªä¼´ã€æ±‚å’Œè«§ï¼Œä»¥å®¶åº­æƒ…æ„Ÿç‚ºæ¶ˆè²»æ ¸å¿ƒé©…å‹•',
    match: (s) => s.A >= 3.5 && s.E <= 3.0
  },
  {
    id: 'sensitive-cautious',
    name: 'æƒ…ç·’æ•æ„Ÿå‹',
    priority: 'C',
    desc: 'æ˜“ç„¦æ…®ã€é«˜æ•æ„Ÿã€æ±‚å®‰ç©©ï¼Œé‡åŸºç¤å®‰å…¨æ„Ÿèˆ‡ç©©å®šæœå‹™',
    match: (s) => s.N >= 3.5
  },
  {
    id: 'frugal-conservative',
    name: 'å‹™å¯¦ç¯€å„‰å‹',
    priority: 'D',
    desc: 'å‹™å¯¦ç¯€å„‰ã€é‡æ€§åƒ¹æ¯”ã€å–œå‚³çµ±ï¼Œå°é«˜ç«¯æœƒå“¡åˆ¶é–€æª»è¼ƒé«˜',
    match: (s) => s.O <= 2.5 && s.C >= 3.5 && s.E <= 2.8
  }
];

const MEMBERSHIP_INFO = {
  A: { label: 'Aç´šæ ¸å¿ƒå®¢ç¾¤', color: 'priority-A', desc: 'é«˜ç«¯é¤Šè€æœƒå“¡åˆ¶ä¸»åŠ›ä»˜è²»è€…ï¼Œç›´æ¥å°æ‡‰é«”é¢ã€æŒæ§ã€çœå¿ƒéœ€æ±‚ï¼Œè½‰åŒ–ç‡æœ€é«˜ã€‚å»ºè­°æä¾›ä¿è­‰é‡‘åˆ¶æœƒå“¡ã€ç®¡å®¶å¼æœå‹™ã€æ¨™æº–åŒ–æµç¨‹æ–¹æ¡ˆã€‚' },
  B: { label: 'Bç´šé«˜æ½›åŠ›å®¢ç¾¤', color: 'priority-B', desc: 'å´é‡éš±ç§ã€é«”é©—ã€ç´°ç¯€ï¼Œé©åˆé€šéé«˜ç«¯é«”é©—èª²æˆ–è©¦ä½æ´»å‹•è½‰åŒ–ï¼Œå…·å‚™é«˜æ¶ˆè²»æ½›åŠ›ã€‚' },
  C: { label: 'Cç´šå¯è½‰åŒ–å®¢ç¾¤', color: 'priority-C', desc: 'å´é‡å®¶åº­ã€æƒ…æ„Ÿã€å‰µæ–°ï¼Œé©åˆä»¥èˆˆè¶£æ„›å¥½å’Œå®¶åº­æ´»å‹•ç‚ºåˆ‡å…¥é»ï¼Œéœ€ä¸€å®šæ™‚é–“åŸ¹è‚²ä¿¡ä»»ã€‚' },
  D: { label: 'Dç´šæ…é¸å®¢ç¾¤', color: 'priority-D', desc: 'å°åƒ¹æ ¼æ•æ„Ÿæˆ–ä¸å–œç¤¾äº¤ï¼Œé›£ä»¥æ¥å—é«˜é–€æª»æœƒå“¡åˆ¶ï¼Œè½‰åŒ–æˆæœ¬æ¥µé«˜ï¼Œå»ºè­°æä¾›åŸºç¤è­·ç†å¥—é¤æ›¿ä»£æ–¹æ¡ˆã€‚' }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// APP STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let state = {
  currentQuestion: 0,
  answers: {},
  userInfo: {},
  marital: ''
};

function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  window.scrollTo(0, 0);
}

function selectMarital(val) {
  state.marital = val;
  document.getElementById('marital-1').classList.toggle('selected', val === 'married');
  document.getElementById('marital-2').classList.toggle('selected', val === 'single');
}

function validateInfo() {
  const name = document.getElementById('f-name').value.trim();
  const gender = document.getElementById('f-gender').value;
  const birthday = document.getElementById('f-birthday').value;
  if (!name) { alert('è«‹è¼¸å…¥å§“å'); return; }
  if (!gender) { alert('è«‹é¸æ“‡æ€§åˆ¥'); return; }
  if (!state.marital) { alert('è«‹é¸æ“‡å©šå§»ç‹€æ³'); return; }
  state.userInfo = { name, gender, birthday, marital: state.marital };
  state.currentQuestion = 0;
  state.answers = {};
  renderQuestion();
  showScreen('screen-questions');
}

function renderQuestion() {
  const q = QUESTIONS[state.currentQuestion];
  const pct = ((state.currentQuestion) / QUESTIONS.length * 100).toFixed(0);
  document.getElementById('progress-bar').style.width = Math.max(pct, 5) + '%';
  document.getElementById('progress-text').textContent = `ç¬¬ ${state.currentQuestion + 1} é¡Œ / å…± ${QUESTIONS.length} é¡Œ`;

  const dimEl = document.getElementById('q-dimension');
  dimEl.textContent = q.dimLabel;
  dimEl.className = `q-dimension ${q.dimClass}`;
  dimEl.style.background = 'rgba(255,255,255,0.05)';
  dimEl.style.border = '1px solid currentColor';

  document.getElementById('q-text').textContent = q.text;

  // Reset scale buttons
  document.querySelectorAll('.scale-btn').forEach((btn, i) => {
    btn.classList.toggle('selected', state.answers[q.id] === (i + 1));
  });

  const isLast = state.currentQuestion === QUESTIONS.length - 1;
  document.getElementById('btn-next').textContent = isLast ? 'æäº¤å•å· âœ“' : 'ä¸‹ä¸€é¡Œ â†’';
  document.querySelector('.q-nav .btn-secondary').style.visibility = state.currentQuestion === 0 ? 'hidden' : 'visible';
}

function selectScale(val) {
  const q = QUESTIONS[state.currentQuestion];
  state.answers[q.id] = val;
  document.querySelectorAll('.scale-btn').forEach((btn, i) => {
    btn.classList.toggle('selected', i + 1 === val);
  });
}

function nextQuestion() {
  const q = QUESTIONS[state.currentQuestion];
  if (!state.answers[q.id]) { 
    // Shake animation hint
    const so = document.getElementById('scale-options');
    so.style.transform = 'translateX(-8px)';
    setTimeout(() => so.style.transform = 'translateX(8px)', 100);
    setTimeout(() => so.style.transform = 'translateX(-5px)', 200);
    setTimeout(() => so.style.transform = '', 300);
    alert('è«‹é¸æ“‡ä¸€å€‹é¸é …'); 
    return; 
  }
  if (state.currentQuestion < QUESTIONS.length - 1) {
    state.currentQuestion++;
    renderQuestion();
  } else {
    calculateResults();
  }
}

function prevQuestion() {
  if (state.currentQuestion > 0) {
    state.currentQuestion--;
    renderQuestion();
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CALCULATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function calculateResults() {
  showScreen('screen-loading');
  setTimeout(() => {
    const scores = { O: 0, C: 0, E: 0, A: 0, N: 0 };
    const counts = { O: 0, C: 0, E: 0, A: 0, N: 0 };

    QUESTIONS.forEach(q => {
      let val = state.answers[q.id] || 3;
      if (q.reversed) val = 6 - val;
      scores[q.dimension] += val;
      counts[q.dimension]++;
    });

    const avg = {};
    ['O','C','E','A','N'].forEach(d => {
      avg[d] = scores[d] / counts[d];
    });

    // Find personality type
    let matched = null;
    for (const type of PERSONALITY_TYPES) {
      if (type.match(avg)) { matched = type; break; }
    }
    if (!matched) matched = PERSONALITY_TYPES[4]; // default

    renderResults(avg, matched);
    showScreen('screen-results');
  }, 1800);
}

function renderResults(scores, pType) {
  const info = state.userInfo;
  const genderMap = { male: 'ç”·', female: 'å¥³', other: 'å…¶ä»–' };
  const maritalMap = { married: 'å·²å©š', single: 'æœªå©š' };

  document.getElementById('res-name').textContent = info.name;
  
  let agePart = '';
  if (info.birthday) {
    const age = Math.floor((new Date() - new Date(info.birthday)) / 31557600000);
    agePart = ` Â· ${age}æ­²`;
  }
  document.getElementById('res-meta').textContent = 
    `${genderMap[info.gender] || ''}${agePart} Â· ${maritalMap[info.marital] || ''} Â· ${new Date().toLocaleDateString('zh-TW')}`;

  document.getElementById('res-type').textContent = `ğŸ® ${pType.name}`;

  // Dimension cards
  const dimOrder = ['O','C','E','A','N'];
  const dimClasses = { O: 'd-o', C: 'd-c', E: 'd-e', A: 'd-a', N: 'd-n' };
  let dimHTML = '';
  dimOrder.forEach(d => {
    const info = DIMENSION_INFO[d];
    const score = scores[d];
    const isHigh = score >= 3.0;
    const pct = ((score - 1) / 4 * 100).toFixed(0);
    const detail = isHigh ? info.high : info.low;
    dimHTML += `
      <div class="dimension-card ${dimClasses[d]}">
        <div class="dim-top">
          <div class="dim-name">${info.fullName}</div>
          <div class="dim-score">${score.toFixed(1)}</div>
        </div>
        <div class="bar-track"><div class="bar-fill" style="width:${pct}%"></div></div>
        <div class="dim-label">
          <span>${detail.label}</span>
          <span>${pct}%</span>
        </div>
      </div>`;
  });
  document.getElementById('res-dimensions').innerHTML = dimHTML;

  // Core needs analysis
  const topDims = dimOrder.map(d => ({d, s: scores[d]}))
    .sort((a,b) => Math.abs(b.s - 3) - Math.abs(a.s - 3));

  let needsItems = '';
  let consumptionItems = '';
  let servicesItems = '';

  dimOrder.forEach(d => {
    const info = DIMENSION_INFO[d];
    const isHigh = scores[d] >= 3.0;
    const detail = isHigh ? info.high : info.low;
    
    needsItems += `<div class="insight-item"><div class="insight-dot"></div><div><strong>${info.name}ï¼š</strong>${detail.need}</div></div>`;
    consumptionItems += `<div class="insight-item"><div class="insight-dot"></div><div><strong>${info.name}ï¼š</strong>${detail.consumption}</div></div>`;
    servicesItems += `<div class="insight-item"><div class="insight-dot"></div><div><strong>${info.name}è¡Œç‚ºç‰¹å¾ï¼š</strong>${detail.behavior}</div></div>`;
  });

  document.getElementById('res-needs').innerHTML = `<div class="insight-title">é¤Šè€æ ¸å¿ƒéœ€æ±‚</div>${needsItems}`;
  document.getElementById('res-consumption').innerHTML = `<div class="insight-title">æ¶ˆè²»å–œå¥½åå‘</div>${consumptionItems}`;
  document.getElementById('res-services').innerHTML = `<div class="insight-title">æ¶ˆè²»è¡Œç‚ºç‰¹å¾</div>${servicesItems}`;

  // Membership
  const mem = MEMBERSHIP_INFO[pType.priority];
  document.getElementById('res-membership').innerHTML = `
    <div class="insight-title">é«˜ç«¯é¤Šè€æœƒå“¡é©é…</div>
    <div class="insight-item"><div class="insight-dot"></div><div>${pType.desc}</div></div>
    <div class="insight-item"><div class="insight-dot"></div><div>${mem.desc}</div></div>
    <span class="priority-badge ${mem.color}">${mem.label}</span>
  `;

  // Trigger bar animations
  setTimeout(() => {
    document.querySelectorAll('.bar-fill').forEach(bar => {
      const w = bar.style.width;
      bar.style.width = '0%';
      setTimeout(() => bar.style.width = w, 50);
    });
  }, 100);
}

function restartQuiz() {
  state = { currentQuestion: 0, answers: {}, userInfo: {}, marital: '' };
  document.getElementById('f-name').value = '';
  document.getElementById('f-gender').value = '';
  document.getElementById('f-birthday').value = '';
  document.getElementById('marital-1').classList.remove('selected');
  document.getElementById('marital-2').classList.remove('selected');
  showScreen('screen-welcome');
}

function shareResult() {
  const name = state.userInfo.name || 'ç”¨æˆ¶';
  const typeEl = document.getElementById('res-type');
  const text = `ã€å¤§äº”äººæ ¼é«˜ç«¯é¤Šè€è©•ä¼°ã€‘\n${name}çš„äººæ ¼é¡å‹ï¼š${typeEl.textContent}\n\nç«‹å³é«”é©—ï¼šhttps://jp169zx-gh.github.io/big5/`;
  if (navigator.share) {
    navigator.share({ title: 'å¤§äº”äººæ ¼é¤Šè€è©•ä¼°çµæœ', text });
  } else {
    navigator.clipboard?.writeText(text).then(() => alert('çµæœå·²è¤‡è£½åˆ°å‰ªè²¼æ¿ï¼'));
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PWA / SERVICE WORKER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let deferredPrompt;

window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  setTimeout(() => {
    document.getElementById('install-banner').classList.add('visible');
  }, 3000);
});

function installPWA() {
  if (deferredPrompt) {
    deferredPrompt.prompt();
    deferredPrompt.userChoice.then(() => {
      deferredPrompt = null;
      closeInstallBanner();
    });
  }
}

function closeInstallBanner() {
  document.getElementById('install-banner').classList.remove('visible');
}

if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('sw.js').catch(() => {});
  });
}
</script>
</body>
</html>
